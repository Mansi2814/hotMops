{% load crispy_forms_filters %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>sign up</title>
    <script type="text/javascript" src="/static/admin/js/vendor/jquery/jquery.js"></script>
    <script type="text/javascript" src="/static/admin/js/jquery.init.js"></script>
</head>
<body>
you are on sign up page
{% load static %}
{% load crispy_forms_tags %}
<script>
    let $ = django.jQuery
    $(function (){
            $("#div_id_otp").hide()
            $("#btn-submit").hide()
            $("#btn-submit-verify-otp").hide()
            $("#btn-sign-up").hide()
        let otp_from_back="";
        $("#btn-submit-get-otp").click(function () {
            let $email = $("#id_email").val()
            $.post("/accounts/send-otp/",
                {
                    "email": $email,
                    "csrfmiddlewaretoken": "{{csrf_token}}"
                },
                function (data, status) {
                    if (status === "success") {
                        if (data != "False"){
                            otp_from_back = data;
                            $("#div_id_otp").show()
                            $("#btn-submit-get-otp").hide()
                            $("#btn-submit-verify-otp").show()
                            $("#id_email").prop('readonly', true)
                        }
                    }
                }
            );
               })

        $("#btn-submit-verify-otp").click(function (){
            let user_otp=$("#id_otp").val();
            if (user_otp===otp_from_back){
                $("#div_id_otp").hide()
                $("#btn-submit").show()
                $("#btn-submit-verify-otp").hide()
                $("#btn-sign-up").show()
                document.getElementById("verification_status").innerText = "OTP Verified"
            }
            else{
                document.getElementById("verification_status").innerText = "OTP Incorrect! Retry"
            }
        })

    })
</script>


{% load mptt_tags %}
    <div class="row">
        <div class="col-xl-3 col-md-6 mb-4"></div>
        <div class="col-xl-4 col-md-6 mb-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Sign Up Form</h6>
                </div>
                <div class="card-body">
{#                     {% include 'display-messages.html' %}#}
                     <form method="POST" class="text-left record-form" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-xl-12 col-sm-6 col-md-3">
                                {% csrf_token %}
                                    {{ form|crispy }}
                                <div class="form-group">
                                    <br>
                                    <div id = "verification_status" style="color: green"></div>
                                    <button class="btn btn-primary  btn-sm" id="btn-submit-get-otp" value = "Send OTP" type="button">Send OTP</button>
                                    <button class="btn btn-primary  btn-sm" id="btn-submit-verify-otp" type = button>Verify OTP</button>
                                    <a href="/accounts/sign-up"><button class="btn btn-warning  btn-sm" type="submit" id="btn-sign-up">Sign Up</button></a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
</html>